<form
  class="p-4 flex flex-col border-t border-gray-700 bg-[#1e1e1e]"
  (ngSubmit)="sendMessage()"
  enctype="multipart/form-data"
>
  <div class="grid grid-cols-[1fr]">
  <!-- File Preview Section -->
    <div class="mb-3" *ngIf="selectedFiles.length > 0">
      <div class="text-sm text-gray-400 mb-2">Selected Files ({{ selectedFiles.length }}/{{ maxFiles }})</div>
      <div class="flex flex-wrap gap-2">
        <div 
          *ngFor="let file of selectedFiles; let i = index" 
          class="relative bg-[#2a2a2a] rounded-lg p-3 border border-gray-600 max-w-[200px]"
        >
          <!-- Remove button -->
          <button 
            type="button"
            (click)="removeFile(i)"
            class="absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-700 transition-colors"
          >
            Ã—
          </button>
          
          <!-- Image preview -->
          <div *ngIf="file.type.startsWith('image/') && file.preview" class="mb-2">
            <img 
              [src]="file.preview" 
              [alt]="file.name"
              class="w-full h-24 object-cover rounded"
            />
          </div>
          
          <!-- File icon for non-images -->
          <div *ngIf="!file.type.startsWith('image/')" class="mb-2 flex justify-center">
            <mat-icon class="text-4xl text-gray-400 h-full">{{ messageAttachmentHelper.getFileIcon(file.type) }}</mat-icon>
          </div>
          
          <!-- File info -->
          <div class="text-xs">
            <div class="text-white font-medium truncate" [title]="file.name">
              {{ file.name }}
            </div>
            <div class="text-gray-400">
              {{ messageAttachmentHelper.formatFileSize(file.size) }}
            </div>
          </div>
        </div>
      </div>
    </div>

  <div class="grid grid-cols-[1fr_70px] gap-1">
    <!-- Message Input Section -->
    <div class="flex items-center w-full relative">
      <label for="fileInput" class="file-input-label ml-2 cursor-pointer absolute" title="Attach files">
        <svg xmlns="http://www.w3.org/2000/svg" class="clip-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="24" height="24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.414a4 4 0 00-5.656-5.656l-6.414 6.414a6 6 0 008.486 8.486L21 13" />
        </svg>
      </label>
      <input
        type="file"
        id="fileInput"
        (change)="onFileSelected($event)"
        accept="image/*,video/*,audio/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt"
        multiple
        class="hidden"
      />
      <textarea
        [(ngModel)]="newMessage"
        name="message"
        rows="2"
        placeholder="Write a message..."
        class="flex-1 px-4 py-2 pl-[40px] rounded bg-[#2a2a2a] text-white focus:outline-none resize-none"
      ></textarea>
    </div>

    <!-- Send Button -->
    <app-button-icon-loader
      [class]="'w-[65px] h-[65px] p-3 flex justify-center bg-primary text-light rounded hover:bg-red-700 transition duration-300 ease-in-out'"
      [isLoading]="messageIsSending"
      (click)="sendMessage()"
    >
        <svg slot="icon" *ngIf="!messageIsSending" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="90%" height="90%" viewBox="0 0 256 256" xml:space="preserve">
          <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)">
            <path d="M 89.999 3.075 C 90 3.02 90 2.967 89.999 2.912 c -0.004 -0.134 -0.017 -0.266 -0.038 -0.398 c -0.007 -0.041 -0.009 -0.081 -0.018 -0.122 c -0.034 -0.165 -0.082 -0.327 -0.144 -0.484 c -0.018 -0.046 -0.041 -0.089 -0.061 -0.134 c -0.053 -0.119 -0.113 -0.234 -0.182 -0.346 C 89.528 1.382 89.5 1.336 89.469 1.29 c -0.102 -0.147 -0.212 -0.288 -0.341 -0.417 c -0.13 -0.13 -0.273 -0.241 -0.421 -0.344 c -0.042 -0.029 -0.085 -0.056 -0.129 -0.082 c -0.118 -0.073 -0.239 -0.136 -0.364 -0.191 c -0.039 -0.017 -0.076 -0.037 -0.116 -0.053 c -0.161 -0.063 -0.327 -0.113 -0.497 -0.147 c -0.031 -0.006 -0.063 -0.008 -0.094 -0.014 c -0.142 -0.024 -0.285 -0.038 -0.429 -0.041 C 87.03 0 86.983 0 86.936 0.001 c -0.141 0.003 -0.282 0.017 -0.423 0.041 c -0.035 0.006 -0.069 0.008 -0.104 0.015 c -0.154 0.031 -0.306 0.073 -0.456 0.129 L 1.946 31.709 c -1.124 0.422 -1.888 1.473 -1.943 2.673 c -0.054 1.199 0.612 2.316 1.693 2.838 l 34.455 16.628 l 16.627 34.455 C 53.281 89.344 54.334 90 55.481 90 c 0.046 0 0.091 -0.001 0.137 -0.003 c 1.199 -0.055 2.251 -0.819 2.673 -1.943 L 89.815 4.048 c 0.056 -0.149 0.097 -0.3 0.128 -0.453 c 0.008 -0.041 0.011 -0.081 0.017 -0.122 C 89.982 3.341 89.995 3.208 89.999 3.075 z M 75.086 10.672 L 37.785 47.973 L 10.619 34.864 L 75.086 10.672 z M 55.136 79.381 L 42.027 52.216 l 37.302 -37.302 L 55.136 79.381 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(255, 255, 255); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round"/>
          </g>
      </svg>
    </app-button-icon-loader>
  </div>

  </div>
    <!-- Error message -->
  <div class="error-message w-full p-2" *ngIf="errorMessage">
    {{ errorMessage }}
  </div>
</form>


